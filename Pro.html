<!doctype html>
<!--
Mars Rover Recycler - Single-file HTML demo
Author: ChatGPT

How to use:
- Save this file as MarsRoverRecycler.html and open in a modern browser (Chrome/Firefox).
- On mobile/Android open via a local web server (or open file directly in many browsers).

Controls:
- Arrow keys / WASD to move rover
- Space to pick up nearby waste automatically
- M to switch to Recycling Machine view
- Drag items from inventory into machine slots, then click CONVERT

Notes:
- This is a demo prototype aiming for "game-like" 3D with textured materials using procedural canvas textures.
- No external assets required. Uses Three.js from CDN.
-->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mars Rover Recycler (Demo)</title>
  <style>
    html,body{height:100%;margin:0;background:#000}
    #gameCanvas{display:block;width:100%;height:100vh}
    #ui{
      position:fixed;left:12px;top:12px;color:#fff;font-family:sans-serif;z-index:50;
      background:rgba(0,0,0,0.25);backdrop-filter:blur(6px);padding:10px;border-radius:8px;
    }
    #inventory{display:flex;gap:8px;margin-top:8px}
    .slot{width:64px;height:64px;border:2px solid rgba(255,255,255,0.12);border-radius:6px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-size:12px}
    #hud-bottom{position:fixed;left:0;right:0;bottom:12px;display:flex;justify-content:center;z-index:49}
    #prompt{background:rgba(0,0,0,0.4);padding:10px;border-radius:8px;color:#fff;font-family:sans-serif}
    #machineUI{position:fixed;right:12px;top:12px;color:#fff;background:rgba(0,0,0,0.3);padding:12px;border-radius:8px;display:none;z-index:60}
    #machineSlots{display:flex;gap:8px}
    button{cursor:pointer;padding:8px 10px;border-radius:6px;border:none;background:#ff7f50;color:#111;font-weight:700}
    @media (max-width:600px){.slot{width:48px;height:48px;font-size:11px}}
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="ui">
    <div><strong>Mars Rover Recycler (Demo)</strong></div>
    <div style="font-size:13px;opacity:0.9">Use WASD / Arrow keys to move • Space to collect • M to go to machine</div>
    <div id="inventory" aria-live="polite"></div>
  </div>
  <div id="machineUI">
    <div style="font-weight:800;margin-bottom:6px">Recycle Machine</div>
    <div id="machineSlots"></div>
    <div style="margin-top:8px;display:flex;gap:8px"><button id="convertBtn">CONVERT</button><button id="backBtn">BACK</button></div>
    <div id="machineLog" style="margin-top:8px;font-size:13px;opacity:0.9"></div>
  </div>
  <div id="hud-bottom"><div id="prompt">Collect wastes across the Martian plain — plastic, metal, organic. Convert at the machine into filament, ingots and fuel.</div></div>

  <!-- Three.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
  // ========== Helper: procedural canvas texture creators ===========
  function makeMarsTexture(size=512){
    const c=document.createElement('canvas');c.width=c.height=size;const ctx=c.getContext('2d');
    // base gradient
    const g=ctx.createLinearGradient(0,0,size,size);
    g.addColorStop(0,'#a14a2a');g.addColorStop(1,'#6f2d20');ctx.fillStyle=g;ctx.fillRect(0,0,size,size);
    // noise
    for(let i=0;i<30000;i++){ctx.fillStyle='rgba(0,0,0,'+(Math.random()*0.06)+')';ctx.fillRect(Math.random()*size,Math.random()*size,1,1)}
    return new THREE.CanvasTexture(c);
  }
  function makeMetalTexture(size=256){const c=document.createElement('canvas');c.width=c.height=size;const ctx=c.getContext('2d');ctx.fillStyle='#8e8e8e';ctx.fillRect(0,0,size,size);
    for(let i=0;i<20000;i++){ctx.fillStyle='rgba(255,255,255,'+(Math.random()*0.07)+')';ctx.fillRect(Math.random()*size,Math.random()*size,1,1)}
    return new THREE.CanvasTexture(c);
  }
  function makePlasticTexture(color='#2b7dff',size=256){const c=document.createElement('canvas');c.width=c.height=size;const ctx=c.getContext('2d');ctx.fillStyle=color;ctx.fillRect(0,0,size,size);
    ctx.globalCompositeOperation='overlay';for(let i=0;i<15000;i++){ctx.fillStyle='rgba(255,255,255,'+(Math.random()*0.03)+')';ctx.fillRect(Math.random()*size,Math.random()*size,1,1)}
    return new THREE.CanvasTexture(c);
  }
  function makeOrganicTexture(size=256){const c=document.createElement('canvas');c.width=c.height=size;const ctx=c.getContext('2d');ctx.fillStyle='#6b4f2b';ctx.fillRect(0,0,size,size);
    for(let i=0;i<12000;i++){ctx.fillStyle='rgba(0,0,0,'+(Math.random()*0.05)+')';ctx.fillRect(Math.random()*size,Math.random()*size,1,1)}
    return new THREE.CanvasTexture(c);
  }

  // ========== Scene setup ==========
  const canvas=document.getElementById('gameCanvas');
  const renderer=new THREE.WebGLRenderer({canvas,antialias:true});renderer.setPixelRatio(window.devicePixelRatio);renderer.setSize(window.innerWidth,window.innerHeight);
  const scene=new THREE.Scene();
  const camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,0.1,1000);
  camera.position.set(0,8,12);
  camera.lookAt(0,0,0);

  // lights
  const hemi=new THREE.HemisphereLight(0xffeedd,0x404040,1.0);scene.add(hemi);
  const dir=new THREE.DirectionalLight(0xffe0c0,0.8);dir.position.set(5,10,2);scene.add(dir);

  // ground
  const groundGeo=new THREE.PlaneGeometry(200,200,64,64);
  const groundMat=new THREE.MeshStandardMaterial({map:makeMarsTexture(),roughness:1});
  const ground=new THREE.Mesh(groundGeo,groundMat);ground.rotation.x=-Math.PI/2;scene.add(ground);

  // simple hills by displacing vertices
  for(let i=0;i<groundGeo.attributes.position.count;i++){const y=(Math.sin(i*0.1)*0.08 + (Math.random()-0.5)*0.03);groundGeo.attributes.position.setY(i,y)}
  groundGeo.computeVertexNormals();

  // Rover (player)
  const rover=new THREE.Group();
  const body=new THREE.Mesh(new THREE.BoxGeometry(1.6,0.6,1),new THREE.MeshStandardMaterial({color:'#d15b3a',metalness:0.3,roughness:0.6}));body.position.y=0.5;rover.add(body);
  const wheelGeom=new THREE.CylinderGeometry(0.25,0.25,0.4,12);
  for(let i=-1;i<=1;i+=2){for(let j=-1;j<=1;j+=2){const w=new THREE.Mesh(wheelGeom,new THREE.MeshStandardMaterial({color:'#333'}));w.rotation.z=Math.PI/2;w.position.set(0.6*i,0.25,0.45*j);rover.add(w)}}
  rover.position.set(0,0,0);scene.add(rover);

  // Waste items
  const wastes=[]; // {mesh,type,pos}
  const types=['plastic','metal','organic'];
  function spawnWaste(n=25){for(let i=0;i<n;i++){const t=types[Math.floor(Math.random()*types.length)];let mesh; if(t==='plastic'){mesh=new THREE.Mesh(new THREE.SphereGeometry(0.25,12,12),new THREE.MeshStandardMaterial({map:makePlasticTexture('#2b7dff'),metalness:0.1,roughness:0.6}))}
    else if(t==='metal'){mesh=new THREE.Mesh(new THREE.BoxGeometry(0.4,0.4,0.4),new THREE.MeshStandardMaterial({map:makeMetalTexture(),metalness:0.9,roughness:0.35}))}
    else {mesh=new THREE.Mesh(new THREE.DodecahedronGeometry(0.32,0),new THREE.MeshStandardMaterial({map:makeOrganicTexture(),metalness:0.05,roughness:0.9}))}
    const x=(Math.random()-0.5)*80; const z=(Math.random()-0.5)*80; mesh.position.set(x,0.2,z); mesh.userData={type:t, collected:false}; scene.add(mesh); wastes.push(mesh);} }
  spawnWaste(32);

  // simple UI inventory
  const inventory=[]; // array of {type}
  const inventoryEl=document.getElementById('inventory');
  function refreshInventory(){inventoryEl.innerHTML=''; for(let i=0;i<6;i++){const s=document.createElement('div');s.className='slot'; if(inventory[i]){s.textContent=inventory[i].type; s.draggable=true; s.dataset.index=i; s.addEventListener('dragstart',e=>{e.dataTransfer.setData('text/plain',i)})}
      inventoryEl.appendChild(s)} }
  refreshInventory();

  // Machine UI
  const machineUI=document.getElementById('machineUI');
  const machineSlotsEl=document.getElementById('machineSlots');
  const machineLog=document.getElementById('machineLog');
  const machineSlots=[null,null, null]; // up to 3 slots
  function refreshMachineSlots(){machineSlotsEl.innerHTML=''; for(let i=0;i<3;i++){const slot=document.createElement('div');slot.className='slot';slot.style.width='72px';slot.style.height='72px';slot.dataset.index=i; if(machineSlots[i]){slot.textContent=machineSlots[i].type}
      slot.addEventListener('dragover',e=>e.preventDefault()); slot.addEventListener('drop',e=>{e.preventDefault();const fromIdx=parseInt(e.dataTransfer.getData('text/plain')); if(!isNaN(fromIdx) && inventory[fromIdx]){machineSlots[i]=inventory[fromIdx]; inventory.splice(fromIdx,1); refreshInventory(); refreshMachineSlots()}});
      machineSlotsEl.appendChild(slot)} }
  refreshMachineSlots();

  document.getElementById('convertBtn').addEventListener('click',()=>{
    // convert each slot
    for(let i=0;i<machineSlots.length;i++){const it=machineSlots[i]; if(!it) continue; if(it.type==='plastic'){machineLog.innerHTML+=("Plastic → Filament created!<br>");}
      else if(it.type==='metal'){machineLog.innerHTML+=("Metal → Ingot formed!<br>");}
      else if(it.type==='organic'){machineLog.innerHTML+=("Organic → Fuel refined!<br>");}
      machineSlots[i]=null;}
    refreshMachineSlots();
  });
  document.getElementById('backBtn').addEventListener('click',()=>{setMode('explore')});

  // Machine front model (in scene) - placed aside
  const machine=new THREE.Group();
  const machineBase=new THREE.Mesh(new THREE.BoxGeometry(3,1.2,1.5),new THREE.MeshStandardMaterial({color:'#333',metalness:0.2,roughness:0.6}));machineBase.position.y=0.6;machine.add(machineBase);
  const machineTop=new THREE.Mesh(new THREE.BoxGeometry(2.4,1.6,0.6),new THREE.MeshStandardMaterial({color:'#222',metalness:0.6,roughness:0.3}));machineTop.position.set(0,1.5,0);machine.add(machineTop);
  machine.position.set(12,0,0);scene.add(machine);

  // modes
  let mode='explore';
  function setMode(m){mode=m; if(m==='machine'){ // camera jumps to front of machine and open UI
      camera.position.set(12,3.2,6); camera.lookAt(12,1,0); machineUI.style.display='block'; document.getElementById('prompt').style.display='none';
    } else {camera.position.set(rover.position.x,8,rover.position.z+12);camera.lookAt(rover.position.x,0,rover.position.z); machineUI.style.display='none'; document.getElementById('prompt').style.display='block'} }

  // simple movement
  const keys={}; window.addEventListener('keydown',e=>{keys[e.key.toLowerCase()]=true; if(e.key===' '){collectNearby()} if(e.key.toLowerCase()==='m'){setMode(mode==='explore'?'machine':'explore')}});
  window.addEventListener('keyup',e=>{keys[e.key.toLowerCase()]=false});

  function collectNearby(){// pick any waste within 1.2m and add to inventory
    for(let i=0;i<wastes.length;i++){const w=wastes[i]; if(w.userData.collected) continue; const d=w.position.distanceTo(rover.position); if(d<1.5){w.userData.collected=true; scene.remove(w); inventory.push({type:w.userData.type}); refreshInventory(); break}} }

  // simple collision / keep rover on ground
  function update(dt){const speed=dt*4; let moved=false; if(keys['arrowup']||keys['w']){rover.position.z-=speed;moved=true} if(keys['arrowdown']||keys['s']){rover.position.z+=speed;moved=true} if(keys['arrowleft']||keys['a']){rover.position.x-=speed;moved=true} if(keys['arrowright']||keys['d']){rover.position.x+=speed;moved=true}
    if(moved){camera.position.x=rover.position.x;camera.position.z=rover.position.z+12; camera.lookAt(rover.position.x,0,rover.position.z)}
  }

  // drag support from inventory to machine UI (already uses HTML drag)

  // animate loop
  let last=performance.now();
  function loop(t){const dt=(t-last)/1000; last=t; update(dt); renderer.render(scene,camera); requestAnimationFrame(loop)} requestAnimationFrame(loop);

  // resize
  window.addEventListener('resize',()=>{renderer.setSize(window.innerWidth,window.innerHeight);camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix()});

  // touch: show simple on-screen joystick for mobile (tiny)
  // (Not full joystick implementation — tap space area to collect on mobile)
  canvas.addEventListener('touchstart',e=>{if(e.touches.length===1){collectNearby()}});

  // quick tips in console
  console.log('Mars Rover Recycler demo loaded. Controls: WASD/arrows to move, Space to collect, M to open machine.');
  </script>
</body>
</html>
